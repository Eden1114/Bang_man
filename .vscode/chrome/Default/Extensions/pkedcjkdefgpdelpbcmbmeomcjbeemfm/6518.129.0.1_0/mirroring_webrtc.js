'use strict';var y9={TAB:0,Ki:1,em:2},z9=function(a){xb("MediaRouter.WebRtc.Start.Success",a,y9)};var D9=function(a,b){Bg.call(this,b);this.F=a;this.b=new zb;this.A=Uw(b.id);this.j=new zb;this.w=!1;this.l=null;this.s=!1;this.o=this.f=null;A9(this);B9(this);C9(this,new Hg("GET_TURN_CREDENTIALS"))};l(D9,Bg);D9.prototype.start=function(a){var b=this;return this.b.b.then(function(c){if(c.f)return Promise.reject(new Ef("Mirroring already started"));if(b.l)return Promise.reject(new Ef("Session permanently stopped"));b.f=new nb("MediaRouter.WebRtc.Session.Launch");c.b.addStream(a);c.start();return b.j.b})};
D9.prototype.stop=function(){var a=this;this.j.reject(new Ef("Session stop requested."));this.o&&(this.o.b(),this.o=null);if(this.l)return this.l;this.s=this.w=!1;this.f=null;return this.l=this.b.b.then(function(a){a.stop()}).then(function(){return a.A.Pa()}).catch(function(b){a.A.Pa();throw b;})};
var A9=function(a){a.A.onMessage=function(b){if(!b.type)throw Error("Message has no type.");switch(b.type){case "TURN_CREDENTIALS":a.b.resolve(new Mg(a.h.id,b.data.credentials));break;case "ANSWER":a.b.b.then(function(a){Ug(a,b.data)});break;case "KNOCK_ANSWER":a.s=!0;a.b.b.then(function(a){Ug(a,b.data)});break;case "STOP":a.j.reject(new Ef("Stop signal received"));a.stop();break;default:throw new Ef("Unknown message type: "+b.type);}}},B9=function(a){a.b.b.then(function(b){Qg(b,function(b){C9(a,
new Hg("OFFER",new Jg(b,a.F,Kg)))});Rg(b,function(b){C9(a,Ig(b))});Ng(b,function(){a.w=!0;C9(a,new Hg("SESSION_START_SUCCESS"));!a.s&&a.f&&a.f.b();a.f=null;a.o=new tb("MediaRouter.WebRtc.Session.Length");a.j.resolve(a)});Pg(b,function(){C9(a,new Hg("SESSION_END"))});Og(b,function(b){a.w||a.j.reject(b);C9(a,new Hg("SESSION_FAILURE"))})})},C9=function(a,b){a.A.sendMessage(b,E9)},E9={channelType:"cloud"};var F9=function(){pg.call(this,"webrtc")};l(F9,pg);g=F9.prototype;g.lg=function(a,b){return new D9(a,b)};g.Wg=function(){z9(0)};g.Tg=function(){z9(1)};g.mi=function(){z9(2)};g.Ug=function(){wb("MediaRouter.WebRtc.Session.End")};g.Vg=function(a){xb("MediaRouter.WebRtc.Start.Failure",a,Df)};g.Kf=function(){wb("MediaRouter.WebRtc.Stream.End")};var G9=new F9;eg("mr.mirror.webrtc.WebRtcService",G9);
