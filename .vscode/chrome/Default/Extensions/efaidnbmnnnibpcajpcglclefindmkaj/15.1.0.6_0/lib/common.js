function dependOn(){"use strict";return[require("util"),require("proxy"),require("analytics")]}var def;require=function(a){"use strict";return a},def=window.define?window.define:function(a,b){"use strict";return b.apply(null,[{ajax:$.ajax.bind($)}])};var exports=acom_analytics={};def(dependOn(),function(a,b,c){"use strict";var e,h,d=null,f="/static/js/aicuc/cpdf-template/sign_in_complete.html",g={"local-dev":{cloud_host:"http://local-test.acrobat.com:8002/",ims_client_id:"acom_extension_test1",ims_client_secret:"2a9d3f64-2381-4f68-ba1a-0dcdd4525a28",redirect_uri:"http://createpdf.dev.dexilab.acrobat.com"+f,cpdf_host:"http://local-test.acrobat.com:8000/",env:"local-dev"},dev:{cloud_host:"http://cloud.dev.dexilab.acrobat.com/",ims_client_id:"acom_extension",ims_client_secret:"7f5cc40b-441c-4a4a-85ac-5b8037a67a7c",redirect_uri:"https://createpdf.stage.acrobat.com"+f,cpdf_host:"http://createpdf.dev.dexilab.acrobat.com/",env:"dev"},test:{cloud_host:"https://cloud.test.dexilab.acrobat.com/",ims_client_id:"acom_extension",ims_client_secret:"7f5cc40b-441c-4a4a-85ac-5b8037a67a7c",redirect_uri:"https://createpdf.stage.acrobat.com"+f,cpdf_host:"https://createpdf.test.dexilab.acrobat.com/",env:"test"},stage:{cloud_host:"https://cloud.stage.acrobat.com/",ims_client_id:"acom_extension",ims_client_secret:"7f5cc40b-441c-4a4a-85ac-5b8037a67a7c",redirect_uri:"https://createpdf.stage.acrobat.com"+f,cpdf_host:"https://createpdf.stage.acrobat.com/",env:"stage"},prod:{cloud_host:"https://cloud.acrobat.com/",ims_client_id:"acom_extension",ims_client_secret:"f8f770cb-748d-441c-97dc-d9d684ab6698",redirect_uri:"https://createpdf.acrobat.com"+f,cpdf_host:"https://createpdf.acrobat.com/",env:"prod"}},i=function(){if(c.event(c.e.EXTENSION_FORCE_UNINSTALL),a.isFF()){var b=require("chrome").Cu,d=b.import("resource://gre/modules/AddonManager.jsm").AddonManager,e=require("sdk/self").id;d.getAddonByID(e,function(a){a.uninstall()})}else chrome.management.uninstallSelf()},j=function(b){if(a.isFF()){var c=require("chrome"),d=c.Cc,e=c.Ci,f=d["@mozilla.org/embedcomp/prompt-service;1"].getService(e.nsIPromptService);f.alert(null,"",b)}else alert(b)},k=function(){var d={Accept:"application/vnd.adobe.dex+json;version=1",Authorization:null,"x-api-client-id":"api_browser_ext"},e={Accept:"application/vnd.adobe.dex+json;version=1","Content-Type":"application/vnd.adobe.dex+json;version=1;charset=utf-8",Authorization:null,"x-api-client-id":"api_browser_ext"},f=function(){return"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".replace(/x/g,function(){return"0123456789abcdef"[Math.floor(16*Math.random())]})};this.proxy=b.proxy.bind(this),this.util=a,this.reset=function(b){this.settings={cpdf_api:null,files_host:null,files_api:null,files_upload:null,files_root:null,fillsign_api:null,auth_token:null,ims_host:null},a.isDevEnv().then(this.proxy(function(c){"undefined"==typeof b&&(b=c?"test":"prod"),h=g[b],a.extend(this.settings,h)}))},this.reset(h),this.connected=function(){return!!this.settings.auth_token},this.setGlobals=function(a){this.globals=a},this.GET_headers=function(){return d["x-request-id"]=f(),d.Authorization=this.settings.auth_token,d},this.POST_headers=function(){return e["x-request-id"]=f(),e.Authorization=this.settings.auth_token,e},this.noToken=function(a){a&&a.reject()},this.filesBaseUris=function(){var b=a.Deferred();return this.settings.files_api?b.resolve():a.ajax({url:this.settings.files_host+"api/base_uris",headers:{Accept:this.GET_headers().Accept,"x-api-client-id":this.GET_headers()["x-api-client-id"]}}).then(this.proxy(function(a){this.settings.files_api=a.api,this.settings.files_upload=a.upload,b.resolve()}),function(){b.reject()}),b.promise()},this.cloudBaseUris=function(){var b=a.Deferred();return this.settings.cloud_api?b.resolve():a.ajax({url:this.settings.cloud_host+"api/base_uris",headers:{Accept:this.GET_headers().Accept,"x-api-client-id":this.GET_headers()["x-api-client-id"]}}).then(this.proxy(function(a){this.settings.cloud_api=a.api,this.settings.files_host=a.files,this.settings.fillsign_api=a.fss,this.settings.ims_host=a.ims,this.settings.cpdf_api=a.cpdf,b.resolve()}),function(){b.reject()}),b.promise()},this.baseUris=function(){var b=a.Deferred();return this.cloudBaseUris().done(this.proxy(function(){this.filesBaseUris().done(this.proxy(function(){b.resolve()}))})),b.promise()},this.connect=function(){var b=a.Deferred();return this.settings.auth_code?(this.baseUris().then(this.proxy(function(){if(this.settings.auth_code){var c={grant_type:"authorization_code",code:this.settings.auth_code,client_id:this.settings.ims_client_id,client_secret:this.settings.ims_client_secret};a.ajax({url:this.settings.ims_host+"ims/token/v1",type:"POST",data:c,contentType:"application/x-www-form-urlencoded;charset=UTF-8"}).then(this.proxy(function(c){var d=(new Date).getTime(),e=/@adobe(test)?\.com$/i.test(c.email);this.settings.auth_code=null,e?(this.settings.auth_token="Bearer "+c.access_token,this.settings.refresh_token=c.refresh_token,this.settings.token_expiry=d+c.expires_in,this.settings.refresh_time=d+c.expires_in/2,this.settings.displayName=c.displayName,b.resolve(),a.consoleLog("got auth token")):(j("PDF Helper Extension is available to Adobe Employees only"),i())}),this.proxy(function(){this.noToken(b)}))}else this.noToken(b)}),this.proxy(function(){this.noToken(b)})),b.promise()):(b.reject(),b.promise())},this.refreshToken=function(b){var e,c=(new Date).getTime(),d=a.Deferred();return this.settings.refresh_token?!b&&c<this.settings.refresh_time?d.resolve():c>this.settings.token_expiry?d.reject():(e={grant_type:"refresh_token",refresh_token:this.settings.refresh_token,client_id:this.settings.ims_client_id,client_secret:this.settings.ims_client_secret},a.ajax({url:this.settings.ims_host+"ims/token/v1",type:"POST",data:e,contentType:"application/x-www-form-urlencoded; charset=UTF-8"}).then(this.proxy(function(b){var c=(new Date).getTime();this.settings.auth_token="Bearer "+b.access_token,this.settings.refresh_token=b.refresh_token,this.settings.token_expiry=c+b.expires_in,this.settings.refresh_time=c+b.expires_in/2,d.resolve(),a.consoleLog("refresh token result"),a.consoleLogDir(b)}),this.proxy(function(){this.noToken(d)}))):d.reject(),d.promise()},this.ajaxReady=function(b){var c=a.Deferred();return this.settings.auth_token?this.refreshToken(b).then(this.proxy(function(){c.resolve()}),this.proxy(function(){this.noToken(c)})):this.connect().then(this.proxy(function(){return this.settings.files_root?void c.resolve():void a.ajax({url:this.settings.files_api+"root",type:"GET",headers:this.GET_headers()}).then(this.proxy(function(a){c.resolve(),this.settings.files_root=a.id}),this.proxy(function(){this.noToken(c)}))}),this.proxy(function(){this.noToken(c)})),c.promise()},this.sso_url=function(b){return a.ajax({url:this.settings.cloud_api+"session/sso_uri?path="+b,type:"GET",headers:this.GET_headers()})},this.authorize=function(a){return this.settings.auth_code=a,this.settings.auth_token=null,delete this.settings.refresh_token,delete this.settings.token_expiry,delete this.settings.refresh_time,this.ajaxReady()},this.clearAuth=function(){this.settings.auth_token&&(a.ajax({url:this.settings.cloud_api+"session",type:"DELETE",headers:e}),delete this.settings.auth_token,delete this.settings.refresh_token,delete this.settings.token_expiry,delete this.settings.refresh_time,delete this.settings.displayName)},this.LOG=function(b,c){function f(a){console.log("Failed to log to splunk"),console.dir(a),e.reject()}var e=a.Deferred();return SETTINGS.USE_ACROBAT?e.resolve():(c=c||20,console.log("LOG: "+JSON.stringify(b)),this.ajaxReady().then(function(){this.util.ajax({url:this.settings.files_api+"send_log_event",type:"POST",data:JSON.stringify({level:c,message:JSON.stringify(b)}),headers:this.POST_headers(),processData:!1}).then(function(){e.resolve(b)},f)}.bind(this),f),e.promise())}.bind(this)};d||(d=new k,a.ajaxError(function(a,b,c,e){401===b.status&&d.clearAuth()}));for(e in d)d.hasOwnProperty(e)&&("function"==typeof d[e]?exports[e]=d[e].bind(d):exports[e]=d[e]);return d});