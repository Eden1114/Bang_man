{"version":3,"sources":["move-control.js"],"names":["cc","Class","extends","Component","properties","_left","_right","_up","_down","moveSpeed","_leftBlock","_rightBlock","_upBlock","_downBlock","realPlayer","_player","onLoad","systemEvent","on","onKeyDown","onKeyUp","node","parent","getChildByName","manager","director","getCollisionManager","enabled","onCollisionEnter","other","self","group","onTouchWall","onCollisionExit","onLeaveWall","blockArray","selfAabb","world","aabb","otherAabb","selfPreAabb","preAabb","otherPreAabb","xMin","xMax","distance","Math","abs","push","direction","yMax","yMin","undefined","name","item","blockName","e","keyCode","KEY","up","down","left","scaleX","children","right","onDirectionMove","touch_end","speed","angle","update","dt","targetVector","pSub","position","moveStep","pMult","pNormalize","x","y","pAdd"],"mappings":"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","file":"move-control.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["/** 通过键盘↑↓←→和space控制移动和防止炸弹*/\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        _left: false,\r\n        _right: false,\r\n        _up: false,\r\n        _down: false,\r\n\r\n        // _gradeLable:{\r\n        //     get: function () {\r\n        //         return this.node.getChildByName('grade').getComponent(cc.Label);\r\n        //     }\r\n        // },\r\n\r\n        moveSpeed: 0,\r\n\r\n        _leftBlock: 0,\r\n        _rightBlock: 0,\r\n        _upBlock: 0,\r\n        _downBlock: 0,\r\n\r\n        realPlayer: false,\r\n        _player: null,\r\n    },\r\n\r\n    onLoad: function () {\r\n        // this._gradeLable.string='Grades:'+window.yourgrade;\r\n        if (this.realPlayer) {\r\n            //移动功能 开启按键的监听\r\n            cc.systemEvent.on('keydown', this.onKeyDown, this);\r\n            cc.systemEvent.on('keyup', this.onKeyUp, this);\r\n        } else {\r\n            this._player = this.node.parent.getChildByName('player');\r\n        }\r\n        //碰撞功能 先打开碰撞回调\r\n        let manager = cc.director.getCollisionManager();\r\n        manager.enabled = true;\r\n    },\r\n\r\n    onCollisionEnter: function (other, self) {\r\n        if (other.node.group == 'static-wall' || other.node.group == 'boom') {\r\n            //如果碰撞的分组是墙壁 调用↓\r\n            this.onTouchWall(other, self);\r\n        }\r\n    },\r\n\r\n    onCollisionExit: function (other, self) {\r\n        if (other.node.group == 'static-wall' || other.node.group == 'boom') {\r\n            //离开墙壁的时候，记得解除碰撞的标志位\r\n            this.onLeaveWall(other, self);\r\n        }\r\n    },\r\n\r\n    onTouchWall: function (other, self) {\r\n        //check the preAabb and aabb\r\n\r\n        let blockArray = [];\r\n        //aabb是碰撞发生后嵌入墙壁的包围盒↓\r\n        let selfAabb = self.world.aabb;\r\n        let otherAabb = other.world.aabb;\r\n        //preAabb是碰撞发生前一帧，未碰撞 还在墙壁外的包围盒↓\r\n        let selfPreAabb = self.world.preAabb;\r\n        let otherPreAabb = other.world.preAabb;\r\n\r\n        //preAabb not touch by aabb touch => the edge blockArray\r\n\r\n        //check left block\r\n        //判断碰撞确实发生的思路是： preAabb的时候某边未嵌入墙壁 但是aabb的时候这个边已经嵌入了墙壁\r\n        //就说明 这preAabb到aabb这个切换过程中，这个边确实碰到了墙壁\r\n        //上下左右四个边都判断一次\r\n        if (selfPreAabb.xMin >= otherAabb.xMax && selfAabb.xMin <= otherAabb.xMax) {\r\n            //left block\r\n            let distance = Math.abs(otherAabb.xMax - selfPreAabb.xMin);\r\n            //然后就保存碰撞的边\r\n            blockArray.push({ distance: distance, direction: 'left' });\r\n        }\r\n        //check right block\r\n        if (selfPreAabb.xMax <= otherAabb.xMin && selfAabb.xMax >= otherAabb.xMin) {\r\n            //right block\r\n            let distance = Math.abs(otherAabb.xMin - selfPreAabb.xMax);\r\n            blockArray.push({ distance: distance, direction: 'right' });\r\n        }\r\n        //check up block\r\n        if (selfPreAabb.yMax <= otherAabb.yMin && selfAabb.yMax >= otherAabb.yMin) {\r\n            //up block\r\n            let distance = Math.abs(otherAabb.yMin - selfPreAabb.yMax);\r\n            blockArray.push({ distance: distance, direction: 'up' });\r\n        }\r\n        //check down block\r\n        if (selfPreAabb.yMin >= otherAabb.yMax && selfAabb.yMin <= otherAabb.yMax) {\r\n            //down block\r\n            let distance = Math.abs(otherAabb.yMax - selfPreAabb.yMin);\r\n            blockArray.push({ distance: distance, direction: 'down' });\r\n        }\r\n        //让墙壁帮我们保存碰撞的数组\r\n        if (other.blockArray == undefined) { other.blockArray = {}; }\r\n        other.blockArray[self.node.name] = blockArray;\r\n\r\n        //遍历碰撞的数组 设置碰撞的标志位\r\n        for (let item of blockArray) {\r\n            let blockName = '_' + item.direction + \"Block\";\r\n            this[blockName] += 1;\r\n        }\r\n    },\r\n\r\n    onLeaveWall: function (other, self) {\r\n        //和touchWall部分同理\r\n        if (other.blockArray !== undefined && other.blockArray[self.node.name] !== undefined) {\r\n            for (let item of other.blockArray[self.node.name]) {\r\n                let blockName = '_' + item.direction + 'Block';\r\n                //不过这次是解除\r\n                this[blockName] -= 1;\r\n            }\r\n            //然后清空碰撞数组\r\n            other.blockArray[self.node.name] = [];\r\n        }\r\n    },\r\n\r\n    onKeyDown: function (e) {\r\n        //在按下的时候设置方向标志位\r\n        switch (e.keyCode) {\r\n            case cc.KEY.up: { this._up = true; break }\r\n            case cc.KEY.down: { this._down = true; break }\r\n            case cc.KEY.left: { this._left = true; this.node.scaleX = -1; this.node.children[0].scaleX = -1; break }\r\n            case cc.KEY.right: { this._right = true; this.node.scaleX = 1; this.node.children[0].scaleX = 1; break }\r\n        }\r\n    },\r\n\r\n    onKeyUp: function (e) {\r\n        //在弹起的时候解除方向标志位\r\n        switch (e.keyCode) {\r\n            case cc.KEY.up: { this._up = false; break }\r\n            case cc.KEY.down: { this._down = false; break }\r\n            case cc.KEY.left: { this._left = false; break }\r\n            case cc.KEY.right: { this._right = false; break }\r\n        }\r\n    },\r\n    \r\n    onDirectionMove: function(touch_end, speed, angle) {\r\n        // this._player.x += dx;\r\n        // this._player.y += dy;\r\n        //console.log(touch_end, speed, angle);\r\n        // this.moveSpeed = speed;\r\n        if(touch_end) {\r\n            this._up = false;\r\n            this._down = false;\r\n            this._left = false;\r\n            this._right = false;\r\n        }\r\n        \r\n        else if(speed > 0) {\r\n            // this.speed = speed;\r\n            this._up = false;\r\n            this._down = false;\r\n            this._left = false;\r\n            this._right = false;\r\n\r\n\r\n            //右\r\n            if ((angle > -22.5 && angle <= 0) || (angle > 0 && angle <= 22.5)) {\r\n                this._right = true;\r\n                this.node.scaleX = 1;\r\n                this.node.children[0].scaleX = 1;\r\n            }\r\n\r\n            //右上\r\n            if (angle > 22.5 && angle <= 22.5 + 45) {\r\n                this._up = true;\r\n                this._right = true;\r\n                this.node.scaleX = 1;\r\n                this.node.children[0].scaleX = 1;\r\n            }\r\n\r\n            //上\r\n            if (angle > 22.5 + 45 && angle <= 22.5 + 90) {\r\n                this._up = true;\r\n            }\r\n\r\n            //左上\r\n            if (angle > 22.5 + 90 && angle <= 22.5 + 135) {\r\n                this._up = true;\r\n                this._left = true;\r\n                this.node.scaleX = -1;\r\n                this.node.children[0].scaleX = -1;\r\n            }\r\n\r\n            //左\r\n            if ((angle > 22.5 + 135 && angle <= 180) || (angle >= -180 && angle <= -180 + 22.5)) {\r\n                this._left = true;\r\n                this.node.scaleX = -1;\r\n                this.node.children[0].scaleX = -1;\r\n            }\r\n\r\n            //左下\r\n            if(angle > -180 +22.5 && angle <= -180 +22.5+ 45) {\r\n                this._down = true;\r\n                this.node.scaleX = -1;\r\n                this.node.children[0].scaleX = -1;\r\n            }\r\n\r\n            //下\r\n            if(angle > -135 + 22.5 && angle <= -90 + 22.5){\r\n                this._down = true;\r\n            }\r\n\r\n            //右下\r\n            if(angle > -90 +22.5 && angle <= -22.5) {\r\n                this._down = true;\r\n                this._right = true;\r\n                this.node.scaleX = 1;\r\n                this.node.children[0].scaleX = 1;\r\n            }\r\n        }\r\n        \r\n    },\r\n\r\n    update: function (dt) {\r\n\r\n        // this._gradeLable.string='Grades:'+window.yourgrade;\r\n        //然后根据标志位移动玩家\r\n        //能够移动的判断标准是  想往某个方向移动并且那个方向畅通无阻 才能移动\r\n        if (!this.realPlayer) {\r\n            //计算玩家位置并不断追逐\r\n            let targetVector = cc.pSub(this._player.position, this.node.position);\r\n            let moveStep = cc.pMult(cc.pNormalize(targetVector), this.moveSpeed);\r\n            if (moveStep.x > 0 && !!this._rightBlock) { moveStep.x = 0; }\r\n            if (moveStep.x < 0 && !!this._leftBlock) { moveStep.x = 0; }\r\n            if (moveStep.y > 0 && !!this._upBlock) { moveStep.y = 0; }\r\n            if (moveStep.y < 0 && !!this._downBlock) { moveStep.y = 0; }\r\n            if (moveStep.x > 0) { this.node.scaleX = 1; this.node.children[0].scaleX = 1; }\r\n            if (moveStep.x < 0) { this.node.scaleX = -1; this.node.children[0].scaleX = -1; }\r\n            this.node.position = cc.pAdd(this.node.position, moveStep);\r\n        } else {\r\n            if (this._left && !this._leftBlock) { this.node.x -= this.moveSpeed }\r\n            if (this._right && !this._rightBlock) { this.node.x += this.moveSpeed }\r\n            if (this._up && !this._upBlock) { this.node.y += this.moveSpeed }\r\n            if (this._down && !this._downBlock) { this.node.y -= this.moveSpeed }\r\n        }\r\n    }\r\n});\r\n"]}