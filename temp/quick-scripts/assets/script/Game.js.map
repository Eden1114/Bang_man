{"version":3,"sources":["Game.js"],"names":["Common","require","JoystickBG","cc","Class","extends","Component","properties","dot","default","type","Node","displayName","ring","stickX","stickY","touchType","TouchType","DEFAULT","directionType","DirectionType","ALL","sprite","_stickPos","_touchLocation","onLoad","_createStickSprite","FOLLOW","_initTouchEvent","node","setPosition","self","on","EventType","TOUCH_START","_touchStartEvent","TOUCH_MOVE","_touchMoveEvent","TOUCH_END","_touchEndEvent","TOUCH_CANCEL","event","getLocation","touchPos","convertToNodeSpaceAR","x","y","distance","_getDistance","p","radius","width","posX","posY","Math","cos","_getRadian","sin","_getAngle","_setSpeed","getPosition","_speed"],"mappings":"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","file":"Game.js","sourceRoot":"../../../../assets/script","sourcesContent":["var Common = require('JoystickCommon');\nvar JoystickBG = require('JoystickBG');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        dot: {\n            default: null,\n            type: cc.Node,\n            displayName: '摇杆节点',\n        },\n        ring: {\n            default: null,\n            type: JoystickBG,\n            displayName: '摇杆背景节点',\n        },\n        stickX: {\n            default: 0,\n            displayName: '摇杆X位置',\n        },\n\n        stickY: {\n            default: 0,\n            displayName: '摇杆Y位置',\n        },\n        touchType: {\n            default: Common.TouchType.DEFAULT,\n            type: Common.TouchType,\n            displayName: '触摸类型',\n        },\n        directionType: {\n            default: Common.DirectionType.ALL,\n            type: Common.DirectionType,\n            displayName: '方向类型',\n\n        },\n        sprite: {\n            default: null,\n            type: cc.Node,\n            displayName: '操控的目标',\n\n        },\n\n        _stickPos: {\n            default: null,\n            type: cc.Node,\n            displayName: '摇杆当前位置',\n        },\n\n        _touchLocation: {\n            default: null,\n            type: cc.Node,\n            displayName: '摇杆当前位置',\n\n        }\n    },\n\n    onLoad: function () {\n        this._createStickSprite();\n        //当触摸类型为FOLLOW会在此对圆圈的触摸监听\n        if (this.touchType == Common.TouchType.FOLLOW) {\n            this._initTouchEvent();\n        }\n    },\n\n    _createStickSprite: function () {\n        //调整摇杆的位置\n        this.ring.node.setPosition(this.stickX, this.stickY);\n        this.dot.setPosition(this.stickX, this.stickY);\n    },\n\n    _initTouchEvent: function () {\n        let self = this;\n\n        self.node.on(cc.Node.EventType.TOUCH_START, self._touchStartEvent, self);\n\n        self.node.on(cc.Node.EventType.TOUCH_MOVE, self._touchMoveEvent, self);\n\n        // 触摸在圆圈内离开或在圆圈外离开后，摇杆归位，player速度为0\n        self.node.on(cc.Node.EventType.TOUCH_END, self._touchEndEvent, self);\n        self.node.on(cc.Node.EventType.TOUCH_CANCEL, self._touchEndEvent, self);\n\n\n    },\n\n    _touchStartEvent: function (event) {\n        // 记录触摸的世界坐标，给touch move使用\n        this._touchLocation = event.getLocation();\n        let touchPos = this.node.convertToNodeSpaceAR(event.getLocation());\n        // 更改摇杆的位置\n        this.ring.node.setPosition(touchPos);\n        this.dot.setPosition(touchPos);\n        // 记录摇杆位置，给touch move使用\n        this._stickPos = touchPos;\n    },\n\n    _touchMoveEvent: function (event) {\n\n        // 如果touch start位置和touch move相同，禁止移动\n        if (this._touchLocation.x == event.getLocation().x && this._touchLocation.y == event.getLocation().y) {\n            return false;\n        }\n        // 以圆圈为锚点获取触摸坐标\n        let touchPos = this.ring.node.convertToNodeSpaceAR(event.getLocation());\n        let distance = this.ring._getDistance(touchPos, cc.p(0, 0));\n        let radius = this.ring.node.width / 2;\n\n        // 由于摇杆的postion是以父节点为锚点，所以定位要加上touch start时的位置\n        let posX = this._stickPos.x + touchPos.x;\n        let posY = this._stickPos.y + touchPos.y;\n        if (radius > distance) {\n            this.dot.setPosition(cc.p(posX, posY));\n        } else {\n            //控杆永远保持在圈内，并在圈内跟随触摸更新角度\n            var x = this._stickPos.x + Math.cos(this.ring._getRadian(cc.p(posX, posY))) * radius;\n            var y = this._stickPos.y + Math.sin(this.ring._getRadian(cc.p(posX, posY))) * radius;\n            this.dot.setPosition(cc.p(x, y));\n        }\n        //更新角度\n        this.ring._getAngle(cc.p(posX, posY));\n        //设置实际速度\n        this.ring._setSpeed(cc.p(posX, posY));\n    },\n\n    _touchEndEvent: function () {\n        this.dot.setPosition(this.ring.node.getPosition());\n        this.ring._speed = 0;\n    },\n\n});\n"]}