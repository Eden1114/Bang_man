{"version":3,"sources":["..\\..\\..\\..\\assets\\script/assets\\script\\player-control.js"],"names":["cc","Class","extends","Component","properties","hp","realPlayer","hurtValue","_hpLabel","get","node","getChildByName","getComponent","Label","_sceneLoading","hurtDurationOfEnemyTouch","_hurtTimeStamp","_enemyRemoving","_gridControl","onLoad","require","Date","now","string","on","onHurt","manager","director","getCollisionManager","enabled","onCollisionStay","other","self","group","checkGridTouch","otherNode","selfNode","otherGrid","getGrid","position","selfGrid","x","y","loadScene","window","enemyNum","removeFromParent"],"mappings":";;;;;;AAAAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,YAAI,GADI;AAERC,oBAAY,KAFJ;AAGRC,mBAAW,CAHH;AAIRC,kBAAU;AACNC,iBAAK,eAAU;AACX,uBAAO,KAAKC,IAAL,CAAUC,cAAV,CAAyB,SAAzB,EAAoCC,YAApC,CAAiDZ,GAAGa,KAApD,CAAP;AACH;AAHK,SAJF;AASRC,uBAAe,KATP;AAURC,kCAA0B,GAVlB,EAUsB;AAC9BC,wBAAgB,IAXR;AAYRC,wBAAgB,KAZR;AAaRC,sBAAc;AAbN,KAHP;;AAmBLC,YAAQ,kBAAY;AAChB,aAAKD,YAAL,GAAoBE,QAAQ,cAAR,CAApB;AACA,aAAKJ,cAAL,GAAsBK,KAAKC,GAAL,EAAtB;;AAEA,aAAKd,QAAL,CAAce,MAAd,GAAuB,KAAKlB,EAA5B;AACA,aAAKK,IAAL,CAAUc,EAAV,CAAa,eAAb,EAA6B,KAAKC,MAAlC,EAAyC,IAAzC;AACA,YAAIC,UAAU1B,GAAG2B,QAAH,CAAYC,mBAAZ,EAAd;AACAF,gBAAQG,OAAR,GAAkB,IAAlB;AAEH,KA5BI;;AA8BL;AACA;AACA;AACA;;AAEAC,qBAAiB,yBAASC,KAAT,EAAeC,IAAf,EAAoB;AACjC,YAAG,KAAK1B,UAAL,IAAmByB,MAAMrB,IAAN,CAAWuB,KAAX,IAAoB,QAA1C,EAAmD;AAC/C;AACA,gBAAG,KAAKC,cAAL,CAAoBH,MAAMrB,IAA1B,EAA+BsB,KAAKtB,IAApC,CAAH,EAA6C;AACzC,oBAAG,KAAKM,cAAL,GAAsB,KAAKD,wBAAL,GAAgC,IAAtD,IAA8DM,KAAKC,GAAL,EAAjE,EAA4E;AACxE,yBAAKG,MAAL;AACA,yBAAKT,cAAL,GAAsBK,KAAKC,GAAL,EAAtB;AACH;AACJ;AACJ;AACJ,KA7CI;;AA+CLY,oBAAgB,wBAASC,SAAT,EAAmBC,QAAnB,EAA4B;AACxC,YAAIC,YAAY,KAAKnB,YAAL,CAAkBoB,OAAlB,CAA0BH,UAAUI,QAApC,CAAhB;AACA,YAAIC,WAAW,KAAKtB,YAAL,CAAkBoB,OAAlB,CAA0BF,SAASG,QAAnC,CAAf;AACA,YAAGF,UAAUI,CAAV,IAAeD,SAASC,CAAxB,IAA6BJ,UAAUK,CAAV,IAAeF,SAASE,CAAxD,EAA0D;AACtD,mBAAO,IAAP;AACH,SAFD,MAEK;AACD,mBAAO,KAAP;AACH;AACJ,KAvDI;;AAyDL;AACA;AACA;AACA;;AAEAjB,YAAQ,kBAAU;AACd,aAAKpB,EAAL,IAAW,KAAKE,SAAhB;AACA,YAAG,KAAKF,EAAL,IAAW,CAAd,EAAgB;AACZ,gBAAG,KAAKC,UAAR,EAAmB;AACf;AACA,oBAAG,CAAC,KAAKQ,aAAT,EAAuB;AACnB,yBAAKA,aAAL,GAAqB,IAArB;AACAd,uBAAG2B,QAAH,CAAYgB,SAAZ,CAAsB,iBAAtB;AACH;AACJ,aAND,MAMK;AACD;AACA,oBAAG,CAAC,KAAK1B,cAAT,EAAwB;AACpB,yBAAKA,cAAL,GAAsB,IAAtB;AACA2B,2BAAOC,QAAP;AACA,yBAAKnC,IAAL,CAAUoC,gBAAV;AACH;AACJ;AACJ,SAfD,MAeK;AACD,iBAAKtC,QAAL,CAAce,MAAd,GAAuB,KAAKlB,EAA5B;AACH;AAEJ;;AAnFI,CAAT","file":"player-control.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        hp: 100,\r\n        realPlayer: false,\r\n        hurtValue: 5,\r\n        _hpLabel: {\r\n            get: function(){\r\n                return this.node.getChildByName('hp-tips').getComponent(cc.Label);\r\n            }\r\n        },\r\n        _sceneLoading: false,\r\n        hurtDurationOfEnemyTouch: 0.5,//just use in enemy\r\n        _hurtTimeStamp: null,\r\n        _enemyRemoving: false,\r\n        _gridControl: null,\r\n    },\r\n\r\n    onLoad: function () {\r\n        this._gridControl = require('grid-control');\r\n        this._hurtTimeStamp = Date.now();\r\n\r\n        this._hpLabel.string = this.hp;\r\n        this.node.on('hurt-by-power',this.onHurt,this);\r\n        let manager = cc.director.getCollisionManager();\r\n        manager.enabled = true;\r\n       \r\n    },\r\n\r\n    // onCollisionEnter: function(other,self){\r\n    //     console.log('enter',other.node.name);\r\n    //     //console.log(self.node.name);\r\n    // },\r\n\r\n    onCollisionStay: function(other,self){\r\n        if(this.realPlayer && other.node.group == 'player'){\r\n            //[add] check the grid\r\n            if(this.checkGridTouch(other.node,self.node)){\r\n                if(this._hurtTimeStamp + this.hurtDurationOfEnemyTouch * 1000 <= Date.now()){\r\n                    this.onHurt();\r\n                    this._hurtTimeStamp = Date.now();\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    checkGridTouch: function(otherNode,selfNode){\r\n        let otherGrid = this._gridControl.getGrid(otherNode.position);\r\n        let selfGrid = this._gridControl.getGrid(selfNode.position);\r\n        if(otherGrid.x == selfGrid.x && otherGrid.y == selfGrid.y){\r\n            return true;\r\n        }else{\r\n            return false;\r\n        }\r\n    },\r\n\r\n    // onCollisionExit: function(other,self){\r\n    //     console.log('exit',other.node.name);\r\n    //     //console.log(self.node.name);\r\n    // },\r\n\r\n    onHurt: function(){\r\n        this.hp -= this.hurtValue;\r\n        if(this.hp <= 0){\r\n            if(this.realPlayer){\r\n                //game over\r\n                if(!this._sceneLoading){\r\n                    this._sceneLoading = true;\r\n                    cc.director.loadScene('game-over-scene');\r\n                }\r\n            }else{\r\n                //enemy removed\r\n                if(!this._enemyRemoving){\r\n                    this._enemyRemoving = true;\r\n                    window.enemyNum--;\r\n                    this.node.removeFromParent();\r\n                }\r\n            }\r\n        }else{\r\n            this._hpLabel.string = this.hp;\r\n        }\r\n        \r\n    }\r\n\r\n});\r\n"]}