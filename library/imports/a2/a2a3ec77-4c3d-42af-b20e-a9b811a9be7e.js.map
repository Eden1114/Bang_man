{"version":3,"sources":["../../../../assets/script/assets/script/player-control.js"],"names":["cc","Class","extends","Component","properties","hp","realPlayer","hurtValue","_hpLabel","get","node","getChildByName","getComponent","Label","_sceneLoading","hurtDurationOfEnemyTouch","_hurtTimeStamp","_enemyRemoving","_gridControl","onLoad","require","Date","now","string","on","onHurt","manager","director","getCollisionManager","enabled","onCollisionStay","other","self","group","checkGridTouch","otherNode","selfNode","otherGrid","getGrid","position","selfGrid","x","y","loadScene","window","enemyNum","removeFromParent"],"mappings":";;;;;;AAAAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,YAAI,GADI;AAERC,oBAAY,KAFJ;AAGRC,mBAAW,CAHH;AAIRC,kBAAU;AACNC,iBAAK,eAAU;AACX,uBAAO,KAAKC,IAAL,CAAUC,cAAV,CAAyB,SAAzB,EAAoCC,YAApC,CAAiDZ,GAAGa,KAApD,CAAP;AACH;AAHK,SAJF;AASRC,uBAAe,KATP;AAURC,kCAA0B,GAVlB,EAUsB;AAC9BC,wBAAgB,IAXR;AAYRC,wBAAgB,KAZR;AAaRC,sBAAc;AAbN,KAHP;;AAmBLC,YAAQ,kBAAY;AAChB,aAAKD,YAAL,GAAoBE,QAAQ,cAAR,CAApB;AACA,aAAKJ,cAAL,GAAsBK,KAAKC,GAAL,EAAtB;;AAEA,aAAKd,QAAL,CAAce,MAAd,GAAuB,KAAKlB,EAA5B;AACA,aAAKK,IAAL,CAAUc,EAAV,CAAa,eAAb,EAA6B,KAAKC,MAAlC,EAAyC,IAAzC;AACA,YAAIC,UAAU1B,GAAG2B,QAAH,CAAYC,mBAAZ,EAAd;AACAF,gBAAQG,OAAR,GAAkB,IAAlB;AAEH,KA5BI;;AA8BL;AACA;AACA;AACA;;AAEAC,qBAAiB,yBAASC,KAAT,EAAeC,IAAf,EAAoB;AACjC,YAAG,KAAK1B,UAAL,IAAmByB,MAAMrB,IAAN,CAAWuB,KAAX,IAAoB,QAA1C,EAAmD;AAC/C;AACA,gBAAG,KAAKC,cAAL,CAAoBH,MAAMrB,IAA1B,EAA+BsB,KAAKtB,IAApC,CAAH,EAA6C;AACzC,oBAAG,KAAKM,cAAL,GAAsB,KAAKD,wBAAL,GAAgC,IAAtD,IAA8DM,KAAKC,GAAL,EAAjE,EAA4E;AACxE,yBAAKG,MAAL;AACA,yBAAKT,cAAL,GAAsBK,KAAKC,GAAL,EAAtB;AACH;AACJ;AACJ;AACJ,KA7CI;;AA+CLY,oBAAgB,wBAASC,SAAT,EAAmBC,QAAnB,EAA4B;AACxC,YAAIC,YAAY,KAAKnB,YAAL,CAAkBoB,OAAlB,CAA0BH,UAAUI,QAApC,CAAhB;AACA,YAAIC,WAAW,KAAKtB,YAAL,CAAkBoB,OAAlB,CAA0BF,SAASG,QAAnC,CAAf;AACA,YAAGF,UAAUI,CAAV,IAAeD,SAASC,CAAxB,IAA6BJ,UAAUK,CAAV,IAAeF,SAASE,CAAxD,EAA0D;AACtD,mBAAO,IAAP;AACH,SAFD,MAEK;AACD,mBAAO,KAAP;AACH;AACJ,KAvDI;;AAyDL;AACA;AACA;AACA;;AAEAjB,YAAQ,kBAAU;AACd,aAAKpB,EAAL,IAAW,KAAKE,SAAhB;AACA,YAAG,KAAKF,EAAL,IAAW,CAAd,EAAgB;AACZ,gBAAG,KAAKC,UAAR,EAAmB;AACf;AACA,oBAAG,CAAC,KAAKQ,aAAT,EAAuB;AACnB,yBAAKA,aAAL,GAAqB,IAArB;AACAd,uBAAG2B,QAAH,CAAYgB,SAAZ,CAAsB,iBAAtB;AACH;AACJ,aAND,MAMK;AACD;AACA,oBAAG,CAAC,KAAK1B,cAAT,EAAwB;AACpB,yBAAKA,cAAL,GAAsB,IAAtB;AACA2B,2BAAOC,QAAP;AACA,yBAAKnC,IAAL,CAAUoC,gBAAV;AACH;AACJ;AACJ,SAfD,MAeK;AACD,iBAAKtC,QAAL,CAAce,MAAd,GAAuB,KAAKlB,EAA5B;AACH;AAEJ;;AAnFI,CAAT","file":"player-control.js","sourceRoot":"../../../../assets/script","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        hp: 100,\n        realPlayer: false,\n        hurtValue: 5,\n        _hpLabel: {\n            get: function(){\n                return this.node.getChildByName('hp-tips').getComponent(cc.Label);\n            }\n        },\n        _sceneLoading: false,\n        hurtDurationOfEnemyTouch: 0.5,//just use in enemy\n        _hurtTimeStamp: null,\n        _enemyRemoving: false,\n        _gridControl: null,\n    },\n\n    onLoad: function () {\n        this._gridControl = require('grid-control');\n        this._hurtTimeStamp = Date.now();\n\n        this._hpLabel.string = this.hp;\n        this.node.on('hurt-by-power',this.onHurt,this);\n        let manager = cc.director.getCollisionManager();\n        manager.enabled = true;\n       \n    },\n\n    // onCollisionEnter: function(other,self){\n    //     console.log('enter',other.node.name);\n    //     //console.log(self.node.name);\n    // },\n\n    onCollisionStay: function(other,self){\n        if(this.realPlayer && other.node.group == 'player'){\n            //[add] check the grid\n            if(this.checkGridTouch(other.node,self.node)){\n                if(this._hurtTimeStamp + this.hurtDurationOfEnemyTouch * 1000 <= Date.now()){\n                    this.onHurt();\n                    this._hurtTimeStamp = Date.now();\n                }\n            }\n        }\n    },\n\n    checkGridTouch: function(otherNode,selfNode){\n        let otherGrid = this._gridControl.getGrid(otherNode.position);\n        let selfGrid = this._gridControl.getGrid(selfNode.position);\n        if(otherGrid.x == selfGrid.x && otherGrid.y == selfGrid.y){\n            return true;\n        }else{\n            return false;\n        }\n    },\n\n    // onCollisionExit: function(other,self){\n    //     console.log('exit',other.node.name);\n    //     //console.log(self.node.name);\n    // },\n\n    onHurt: function(){\n        this.hp -= this.hurtValue;\n        if(this.hp <= 0){\n            if(this.realPlayer){\n                //game over\n                if(!this._sceneLoading){\n                    this._sceneLoading = true;\n                    cc.director.loadScene('game-over-scene');\n                }\n            }else{\n                //enemy removed\n                if(!this._enemyRemoving){\n                    this._enemyRemoving = true;\n                    window.enemyNum--;\n                    this.node.removeFromParent();\n                }\n            }\n        }else{\n            this._hpLabel.string = this.hp;\n        }\n        \n    }\n\n});\n"]}